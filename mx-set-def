#!/bin/bash

TMP_RFS_P1="/dev/shm/rfs_p1"

KERNEL_PART=$(cat /proc/cmdline)
KERNEL_PART="${KERNEL_PART##*root=}"
KERNEL_PART="${KERNEL_PART%% *}"
KERNEL_PART="${KERNEL_PART%%2}1"

# set to default kernel
mkdir ${TMP_RFS_P1}
mount ${KERNEL_PART} ${TMP_RFS_P1}
mv /overlayfs/v1/p1/* ${TMP_RFS_P1}/
umount ${KERNEL_PART}

# prepare to set to default root file system
fw_setenv overlay_flag default
reboot

